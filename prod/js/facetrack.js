let _isWebAssemblySupported=function(){let e="object"==typeof WebAssembly;return e&&!function(){let e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)}()&&(e=!1),e}();function readWASMBinary(e,t,n,i){let a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=function(){200===a.status||0===a.status&&a.response?t(a.response):n()},a.onerror=n,a.onprogress=i,a.send(null)}function addBRFScript(){let e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("async",!0),e.setAttribute("src",brfv4BaseURL+brfv4SDKName+".js"),document.getElementsByTagName("head")[0].appendChild(e)}let brfv4Example={stats:{}},brfv4BaseURL=_isWebAssemblySupported?"libs/brf_wasm/":"libs/brf_asmjs/",brfv4SDKName="BRFv4_JS_TK101018_v4.1.0_trial",brfv4WASMBuffer=null,handleTrackingResults=function(e,t,n,i){},onResize=function(){console.log("resize");let e=document.querySelector(".p5Canvas");document.getElementById("_imageData").style.display="none";let t=window.innerWidth,n=window.innerHeight,i=n/e.height;e.width*i<t&&(i=t/e.width);let a=.5*(t-e.width*i),o=.5*(n-e.height*i);e.style.transformOrigin="0% 0%",e.style.transform="matrix("+i+", 0, 0, "+i+", "+a+", "+o+")"},onInitBRFv4=function(e,t){},c=null,brfv4=null,centerX=null,centerY=null;function initExample(){let e=document.getElementById("_webcam"),t=document.getElementById("_imageData"),n=null,i=null,a=null,o=-1,r=new p5(function(e){e.setup=function(){c=document.querySelector("canvas.p5Canvas").getContext("2d"),e.noLoop(),e.pixelDensity(1),centerX=e.width/2,centerY=e.height/2},e.draw=function(){}}),s=/iPad|iPhone|iPod/.test(window.navigator.userAgent)&&!window.MSStream;function l(){console.log("startCamera"),window.navigator.mediaDevices.getUserMedia({video:{width:640,height:480,frameRate:30}}).then(function(i){console.log("onStreamFetched"),e.srcObject=i,e.play(),null===n?function i(){console.log("onStreamDimensionsAvailable: "+(0!==e.videoWidth)),0===e.videoWidth?setTimeout(i,100):(t.width=e.videoWidth,t.height=e.videoHeight,n=t.getContext("2d"),r.createCanvas(n.canvas.width,n.canvas.height),centerX=t.width/2,centerY=t.height/2,s&&(e.pause(),e.srcObject.getTracks().forEach(function(e){e.stop()})),d())}():u()}).catch(function(){alert("No camera available.")})}function d(){if(null===brfv4&&window.hasOwnProperty("initializeBRF")&&(brfv4={locateFile:function(e){return brfv4BaseURL+e},wasmBinary:brfv4WASMBuffer},initializeBRF(brfv4)),brfv4&&brfv4.sdkReady){let e=document.createElement("script");e.setAttribute("src","sketch.js"),document.querySelector("body").append(e),a=new brfv4.Rectangle(0,0,t.width,t.height),(i=new brfv4.BRFManager).init(a,a,"com.tastenkunst.brfv4.js.examples.minimal.webcam"),onInitBRFv4(i,a),s?setTimeout(function(){console.log("delayed camera restart for iOS"),l()},2e3):u()}else setTimeout(d,250)}function u(){let t=window.performance.now();n.setTransform(-1,0,0,1,a.width,0),n.drawImage(e,0,0,a.width,a.height),n.setTransform(1,0,0,1,0,0),i.update(n.getImageData(0,0,a.width,a.height).data),handleTrackingResults(brfv4,i.getFaces(),r,n.getImageData(0,0,a.width,a.height).data),o>=0&&clearTimeout(o);let s=window.performance.now()-t;o=setTimeout(function(){u()},1e3/30-s)}l()}console.log("Checking support of WebAssembly: "+_isWebAssemblySupported+" "+(_isWebAssemblySupported?"loading WASM (not ASM).":"loading ASM (not WASM).")),_isWebAssemblySupported?readWASMBinary(brfv4BaseURL+brfv4SDKName+".wasm",function(e){brfv4WASMBuffer=e,addBRFScript(),initExample()},function(e){console.error(e)},function(e){console.log(e)}):(addBRFScript(),initExample());